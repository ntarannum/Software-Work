<link rel='stylesheet' href='web/swiss.css'/>

# CO2006 17-18 - SPRINT 3 - MINIPROJECT

## Disclaimer on Plagiarism and Collusion

This is an **individual piece of coursework** that is assessed. Plagiarism, including collusion, is penalized. For further information check the [section Referencing and Academic Integrity in the BSc handbook](https://campus.cs.le.ac.uk/ForStudents/handbooks17/BScStudentHandbook2017-18.pdf).

By submitting your solution, you are stating that you are aware of the consequences, as summarized in the [Declaration of Academic Honesty](https://campus.cs.le.ac.uk/ForStudents/plagiarism/DoAIF.pdf) that you signed already, and that the solution provided for the worksheet is the result of your **sole individual work**.

## Description

An initial prototype of a login system has been implemented as a Spring MVC web application. After a meeting with the main stakeholders, this first prototype is assumed to be correct and is going to be modified in different branches of development by different teams for different products. In order to ensure that subsequent changes do not affect the original functionality of the system, an executable specification of the system has to be developed in the file [src/test/groovy/LoginSpec.groovy](https://github.com/uol-inf/CO2006-17-18/blob/master/sprint3/miniproject/src/test/groovy/app/LoginSpec.groovy).

Two important aspects need to be considered when designing and developing the feature specification:
1. **Navigation route coverage**: all possible navigation routes have to be tested, considering navigation using request mappings and redirections in the controllers, and validation code in the validator classes. That is, the code that has to be inspected is in request handler methods of controllers (`LoginController` and `SignupController`) and in classes providing support for validation (`UserInfoLoginValidator` and `UserInfoValidator`).
2. **Feature methods** (test cases): 
    * Test cases must be developed using the [Spock framework](http://spockframework.org/) and they should be well documented using behaviour-driven development stories, using the structure `given/when/then` (or equivalent). 
    * There must be a test case for each route in the JUnit report generated by the command `./gradlew clean test` (or equivalent command in Windows) at `build/reports/tests/test/index.html` (test cases listed under `app>LoginSpec`). If you use a block `where:`, apply [method unrolling](http://spockframework.org/spock/docs/1.1/all_in_one.html#_method_unrolling) using the annotation `@Unroll` and placeholders in the name of the test case. 
    * All test cases must pass but the oracle in the test case must be meaningful. That is, a test case that is always correct independently of the system will be deemed to be incorrect.

Copy the source code of the login system to your GitHub repository and develop the specification in the file [src/test/groovy/app/LoginSpec.groovy](https://github.com/uol-inf/CO2006-17-18/blob/master/sprint3/miniproject/src/test/groovy/app/LoginSpec.groovy).

## Exercises

### Rubric

In order to give an idea of the level of effort required for each exercise, exercises are tagged with a level of difficulty as follows:
  * :star: : The effort lays in implementing the description of the given test case. The challenge consists in using appropriate matchers (from `Hamcrest` or from `Spring MVC Test`) to define assertions as described.    
  * :star::star: : As above but the structure of the test case is not given. You need to determine what blocks to use and document the appropriately. The challenge consists in developing feature methods using Spock and in defining correct assertions, which are not given explicitly. 
  * :star::star::star:: As above but the test cases are not given, you need to find with the help of [Jacoco](http://www.eclemma.org/jacoco/). The challenge consists in knowing **when to stop testing**, considering the [aspects described above](#description), and **in determining the correctness of the test cases**. 
  
### :star: A. Writing feature methods [50 marks]

Implement the following feature methods in the class `LoginSpec` using `Spock` and appropriate matchers for the assertions. All test cases under this section carry equal marks.

Only **valid** test cases that **pass** are considered correct. That is:
  * tests with assertions that are always correct or incorrect do not contribute towards the mark; and
  * failures do not contribute towards the mark.

0. 

**Given** the context of the controller is setup<br/>
**When** I perform an HTTP GET '/'<br/>
**Then** the status of the HTTP reponse should be `Ok` (`200`)<br/> 
**And** I should see the view `Landing`<br/>

1.

**Given** the context of the controller is setup<br/>
**When** I perform an HTTP GET '/main'<br/>
**Then** the status of the HTTP reponse should be `Ok` (`200`)<br/> 
**And** I should see the view `Main`<br/>

2.

**Given** the context of the controller is setup<br/>
**When** I perform an HTTP GET '/login'<br/>
**Then** the status of the HTTP reponse should be `Ok` (`200`)<br/> 
**And** I should see the view `Login`<br/>

3. 

**Given** the context of the controller is setup<br/>
**When** I perform an HTTP POST `/authenticate` with<br/>
  * `accept = ''`
  * `login = 'a'`
  * `password = ''`

**Then** the status of the HTTP reponse should be `Ok` (`200`)<br/> 
**And** I should see the view `Login`<br/> 

4.

**Given** the context of the controller is setup<br/>
**When** I perform an HTTP POST `/authenticate` with<br/>
  * `accept = ''`
  * `login = ''`
  * `password = 'a'`

**Then** the status of the HTTP reponse should be `Ok` (`200`)<br/> 
**And** I should see the view `Login`<br/> 

5.

**Given** the context of the controller is setup<br/>
**When** I perform an HTTP POST `/add` with<br/>
  * `add=''`
  * `forenames = 'Joe'`
  * `lastnames = 'Smith'`
  * `login = 'js100'`
  * `password = 'js100'`
  * `password2 = 'js100'`

**Then** I should see the view `redirect:login/`<br/> 


6.

**Given** the context of the controller is setup<br/>
**When** I perform an HTTP POST `/add` with<br/>
  * `add=''`
  * `forenames = ''`
  * `lastnames = 'Smith'`
  * `login = 'js100'`
  * `password = 'js100'`
  * `password2 = 'js100'`

**Then** I should see the view `Signup`<br/> 

7.

**Given** the context of the controller is setup<br/>
**When** I perform an HTTP POST `/add` with<br/>
  * `add=''`
  * `forenames = 'Joe'`
  * `lastnames = ''`
  * `login = 'js100'`
  * `password = 'js100'`
  * `password2 = 'js100'`

**Then** I should see the view `Signup`<br/> 

### :star::star: B. Building a specification from semi-informal requirements [20 marks]

Implement the following scenarios as feature methods in the class `LoginSpec` using `Spock` and appropriate matchers for the assertions. All test cases under this section carry equal marks.


Only **valid** test cases that **pass** are considered correct. That is:
  * tests with assertions that are always correct or incorrect do not contribute towards the mark; and
  * failures do not contribute towards the mark.
  
  
8. The HTTP GET request `/signup` should redirect the user to the view `Signup`
9. The HTTP POST request `/authenticate` with the values listed below for the attributes of the command object `userInfoLogin` should redirect the user to view `Login`:
    * `accept = ''`
    * `login = 'user'`
    * `password = 'a'` 

10. The HTTP POST request `/add` with the values listed below for the attributes of the command object `userInfo` should redirect the user to view `Signup`:
    * `add=''`
    * `forenames = 'Joe'`
    * `lastnames = 'Smith'`
    * `login = ''`
    * `password = 'js100'`
    * `password2 = 'js100'`

11. The HTTP POST request `/add` with the values listed below for the attributes of the command object `userInfo` should redirect the user to view `Signup`:
    * `add=''`
    * `forenames = 'Joe'`
    * `lastnames = 'Smith'`
    * `login = 'js100'`
    * `password = ''`
    * `password2 = 'js100'`

### :star::star::star: C. Build a feature specification that is complete and correct [30 marks]

Complete the feature specification with feature methods in order to guarantee that you have tested the web app in full. That is, find as many feature methods as possible in order to achieve 100% coverage of the source code, ensuring that all possible navigation routes have been covered. We are going to use [Jacoco](http://www.eclemma.org/jacoco/) for computing code coverage with respect to a JUnit test suite.

Note that, in addition, test cases must be correct.

Two main aspects are going to be considered when marking this section:
1. **Navigation route coverage**: a percentage of the covered navigational routes will be considered as an upper bound of your mark. That is if tests cases only cover 90% of all the possible navigation routes, the maximum mark is 90%.
2. **Test cases**: 
    * The mark for each test is computed with respect to the percentage of navigation routes covered. For a given coverage percentage, e.g. 90% of navigation routes, if there are several tests for the same navigation route, the mark for each test case will be small. For example, if you have 20 tests, the mark for each test will be of 4.5 marks out of 100 (`= 90/20`), and 1.35 out of 30.<br/>
If, instead, only the minimum amount of tests for exercising the system navigational routes is provided, the test will carry a greater mark. For example, if this bound was 2 tests, each test case developed would be worth 45 marks (`= 90/2`) out of 100, and 13.5 out of 30.
    * Only **valid** test cases that **pass** are considered correct. That is:
      * tests with assertions that are always correct or incorrect do not contribute towards the mark; and
      * failures do not contribute towards the mark.
    * *Hint*: there are less than 20 test cases.
    
There is no limit in the number of test cases to be developed but there is a point where adding more test cases is pointless (and it is your job, as a tester, to find what this upper bound may be). However, please do not try with more than 20 test cases.



## Submission procedure

### Checkpoint: Wed 15/11/2017, 23:59 (midnight)

* Commit and push your mini project (the whole project) to your GitHub repository, under the folder `sprint3/miniproject` so that you can find your file `gradle.build` in `sprint3/miniproject/gradle.build` 
* A smoke test (that is, a simple test with a trivial assertion, e.g. `1==1`) should be available so that when `./gradlew test` (or equivalent command for `MS Windows`) is executed, the Spock test report should be generated automatically without problems. This should have been generated at `build/spock-reports/index.html`. In addition, a JUnit report should appear at `build/reports/tests/test/index.html`.

### Release: Wed 22/11/2017, 23:59 (midnight)

* The steps for the checkpoint, as explained above, should have been implemented. 
* Make a release on GitHub
  1. Open the repo in Github
  2. Click Releases
  3. Click `Create a new release` 
  4. Enter the `Tag Version` as `sprint3` (leave `@ Target Master`)
  5. Enter the `Release Title` as `Sprint 3 submission`
  6. Click `Publish Release` 


## Submission

This assignment is worth **20%** of the overall module mark and the mark is provided out of **100**:
* 10% for the checkpoint submission
* 90% for the release submission

### CHECKPOINT SUBMISSION (10%)

We are going to consider that the software infrastructure for the assignment is set up:
1. The code is available in your repository the right location: 2.5 marks
2. The `./gradlew test` command can be executed without problems after adding a smoke test (with a dummy assertion): 5 marks
3. The Spock report is generated for the smoke test: 2.5 marks

Note that it is not possible to solve `2` without solving `1`, and `3` without solving `2`.    


### RELEASE SUBMISSION (90%)

The project submitted must compile and it must be executable as explained in the worksheet (e.g. there are compilation errors) with the command `./gradlew clean test`. Otherwise, the submission will receive a mark of `0` (`zero`).

